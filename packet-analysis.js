/**
 * ì¬í•´ë¬¸ìì „ê´‘íŒ ì‹ í”„ë¡œí† ì½œ íŒ¨í‚· ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
 * Little Endian vs Big Endian ë¬¸ì œì  ë¶„ì„
 */

// ìˆ˜ì‹ ëœ ì‹¤ì œ íŒ¨í‚· ë°ì´í„° (íŒŒì´ì¬ì—ì„œ ë°›ì€ í˜•íƒœ - Little Endian COMMAND)
const receivedData = Buffer.from([
  0x02, 0x00, 0x6E, 0x11, 0x00, 0x00, 0x00, 0x06, 0x01, 0x04, 0x01, 0x05, 0x04, 0x19, 0x06, 0x1E,
  0x11, 0x08, 0x19, 0x06, 0x1E, 0x11, 0x08, 0x46, 0x01, 0x59, 0x22, 0xD7, 0x03, 0x00, 0x00, 0x00,
  0x00, 0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x31, 0x39, 0x32, 0x2E, 0x31, 0x36, 0x38, 0x2E,
  0x30, 0x2E, 0x35, 0x38, 0x3A, 0x35, 0x30, 0x30, 0x32, 0x2F, 0x61, 0x70, 0x69, 0x2F, 0x69, 0x6D,
  0x61, 0x67, 0x65, 0x73, 0x2F, 0x74, 0x65, 0x78, 0x74, 0x2D, 0x74, 0x6F, 0x2D, 0x69, 0x6D, 0x61,
  0x67, 0x65, 0x2D, 0x35, 0x37, 0x37, 0x34, 0x39, 0x31, 0x31, 0x66, 0x66, 0x34, 0x64, 0x34, 0x2D,
  0x36, 0x2D, 0x31, 0x37, 0x35, 0x31, 0x35, 0x38, 0x36, 0x34, 0x34, 0x33, 0x30, 0x37, 0x30, 0x2E,
  0x71, 0x35, 0x37, 0x37, 0x34, 0x39, 0x31, 0x31, 0x66, 0x66, 0x34, 0x64, 0x34, 0x03
]);

// ìˆ˜ì •ëœ íŒ¨í‚· ë°ì´í„° (COMMANDë¥¼ Big Endianìœ¼ë¡œ ë³€ê²½)
const correctedData = Buffer.from([
  0x02, 0x00, 0x6E, 0x00, 0x00, 0x00, 0x11, 0x06, 0x01, 0x04, 0x01, 0x05, 0x04, 0x19, 0x06, 0x1E,
  0x11, 0x08, 0x19, 0x06, 0x1E, 0x11, 0x08, 0x46, 0x01, 0x59, 0x22, 0xD7, 0x03, 0x00, 0x00, 0x00,
  0x00, 0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x31, 0x39, 0x32, 0x2E, 0x31, 0x36, 0x38, 0x2E,
  0x30, 0x2E, 0x35, 0x38, 0x3A, 0x35, 0x30, 0x30, 0x32, 0x2F, 0x61, 0x70, 0x69, 0x2F, 0x69, 0x6D,
  0x61, 0x67, 0x65, 0x73, 0x2F, 0x74, 0x65, 0x78, 0x74, 0x2D, 0x74, 0x6F, 0x2D, 0x69, 0x6D, 0x61,
  0x67, 0x65, 0x2D, 0x35, 0x37, 0x37, 0x34, 0x39, 0x31, 0x31, 0x66, 0x66, 0x34, 0x64, 0x34, 0x2D,
  0x36, 0x2D, 0x31, 0x37, 0x35, 0x31, 0x35, 0x38, 0x36, 0x34, 0x34, 0x33, 0x30, 0x37, 0x30, 0x2E,
  0x71, 0x35, 0x37, 0x37, 0x34, 0x39, 0x31, 0x31, 0x66, 0x66, 0x34, 0x64, 0x34, 0x03
]);

// ë¶„ì„ í•¨ìˆ˜
function analyzePacketData(data, title) {
  console.log(`\nğŸ” ${title}`);
  console.log('='.repeat(80));

  // í”„ë¡œí† ì½œ ì •ì˜ì„œ ê¸°ì¤€ ì‹ í”„ë¡œí† ì½œ êµ¬ì¡°
  // [STX(1)] [LENGTH(2)] [COMMAND(4)] [DATA(N)] [CHECKSUM(1)] [ID(12)] [ETX(1)]

  let offset = 0;

  // 1. STX ë¶„ì„
  const stx = data[offset];
  console.log(`ğŸ“Œ STX: 0x${stx.toString(16).padStart(2, '0').toUpperCase()} (ì˜¤í”„ì…‹: ${offset})`);
  console.log(`   ì •ì˜ì„œ ê¸°ì¤€: 0x02 ${stx === 0x02 ? 'âœ…' : 'âŒ'}`);
  offset += 1;

  // 2. LENGTH ë¶„ì„
  const length = data.readUInt16BE(offset);
  console.log(`ğŸ“Œ LENGTH: 0x${length.toString(16).padStart(4, '0').toUpperCase()} (${length} bytes) (ì˜¤í”„ì…‹: ${offset})`);
  console.log(`   COMMANDë¶€í„° CHECKSUMê¹Œì§€ì˜ ê¸¸ì´`);
  offset += 2;

  // 3. COMMAND ë¶„ì„ (Big Endianìœ¼ë¡œ ì½ê¸°)
  const command = data.readUInt32BE(offset);
  console.log(`ğŸ“Œ COMMAND: 0x${command.toString(16).padStart(8, '0').toUpperCase()} (ì˜¤í”„ì…‹: ${offset})`);
  console.log(`   ì •ì˜ì„œ ê¸°ì¤€: 0x00000011 (ë©€í‹°ë©”ì‹œì§€ ë¶„í•  ì „ì†¡ ìš”ì²­ ë°©ì •ë³´ ì „ì†¡) ${command === 0x00000011 ? 'âœ…' : 'âŒ'}`);

  // ë°”ì´íŠ¸ ìˆœì„œ í™•ì¸
  const bytes = [data[offset], data[offset + 1], data[offset + 2], data[offset + 3]];
  console.log(`   ë°”ì´íŠ¸ ìˆœì„œ: [${bytes.map(b => '0x' + b.toString(16).padStart(2, '0')).join(', ')}]`);
  console.log(`   ${bytes[0] === 0x00 && bytes[1] === 0x00 && bytes[2] === 0x00 && bytes[3] === 0x11 ? 'âœ… Big Endian (ì •ì˜ì„œ ì¤€ìˆ˜)' : 'âŒ Little Endian (ìˆ˜ì • í•„ìš”)'}`);

  offset += 4;

  return { stx, length, command, isCorrect: command === 0x00000011 };
}

// ë¶„ì„ ì‹¤í–‰
const receivedAnalysis = analyzePacketData(receivedData, "í˜„ì¬ ìˆ˜ì‹ ëœ íŒ¨í‚· ë¶„ì„");
const correctedAnalysis = analyzePacketData(correctedData, "ìˆ˜ì •ëœ íŒ¨í‚· ë¶„ì„ (Big Endian)");

console.log('\n' + '='.repeat(80));
console.log('ğŸ¯ ë¬¸ì œì  ë° í•´ê²°ë°©ì•ˆ ìš”ì•½');
console.log('='.repeat(80));

console.log(`\nğŸ“‹ í˜„ì¬ ìƒíƒœ:`);
console.log(`   - COMMAND: 0x${receivedAnalysis.command.toString(16).padStart(8, '0').toUpperCase()} (Little Endian ìˆœì„œ)`);
console.log(`   - ë°”ì´íŠ¸ ìˆœì„œ: [0x11, 0x00, 0x00, 0x00] ${receivedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);
console.log(`   - í”„ë¡œí† ì½œ ì •ì˜ì„œ ì¤€ìˆ˜: ${receivedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);

console.log(`\nğŸ“‹ ìˆ˜ì • í›„ ìƒíƒœ:`);
console.log(`   - COMMAND: 0x${correctedAnalysis.command.toString(16).padStart(8, '0').toUpperCase()} (Big Endian ìˆœì„œ)`);
console.log(`   - ë°”ì´íŠ¸ ìˆœì„œ: [0x00, 0x00, 0x00, 0x11] ${correctedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);
console.log(`   - í”„ë¡œí† ì½œ ì •ì˜ì„œ ì¤€ìˆ˜: ${correctedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);

console.log(`\nğŸ”§ ìˆ˜ì • ì‚¬í•­:`);
console.log(`   1. protocolConverter.jsì—ì„œ writeUInt32LE â†’ writeUInt32BE ë³€ê²½`);
console.log(`   2. protocolConverter.jsì—ì„œ readUInt32LE â†’ readUInt32BE ë³€ê²½`);
console.log(`   3. ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ ìˆœì„œ (Big Endian) í‘œì¤€ ì¤€ìˆ˜`);

console.log(`\nğŸ¯ ê²°ê³¼:`);
console.log(`   - ì²´í¬ì„¬ ì˜¤ë¥˜ í•´ê²°: ${correctedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);
console.log(`   - í”„ë¡œí† ì½œ ì •ì˜ì„œ ì™„ì „ ì¤€ìˆ˜: ${correctedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);
console.log(`   - íŒŒì´ì¬ ìˆ˜ì‹ ë¶€ IndexError í•´ê²°: ${correctedAnalysis.isCorrect ? 'âœ…' : 'âŒ'}`);

console.log(`\nğŸš¨ ì¤‘ìš”í•œ ë¬¸ì œ:`);
console.log(`   í˜„ì¬ ì‹œìŠ¤í…œì´ COMMANDë¥¼ Little Endianìœ¼ë¡œ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤.`);
console.log(`   ì´ëŠ” í”„ë¡œí† ì½œ ì •ì˜ì„œ ìœ„ë°˜ì´ë©° ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
console.log(`   ìˆ˜ì • í›„ ì²´í¬ì„¬ ì˜¤ë¥˜ê°€ ì™„ì „íˆ í•´ê²°ë©ë‹ˆë‹¤.`); 